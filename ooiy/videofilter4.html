<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Slideshow FX Studio Pro</title>
    <style>
        :root {
            --primary: #f43f5e;
            --bg: #09090b;
            --card: #18181b;
            --accent: #3b82f6;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: var(--bg);
            color: white;
            margin: 0; padding: 0;
            display: flex; flex-direction: column; height: 100vh;
            overflow: hidden;
        }

        .preview-window {
            position: relative;
            flex-grow: 1;
            background: #000;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden;
        }

        canvas { max-width: 100%; max-height: 100%; object-fit: contain; box-shadow: 0 0 50px rgba(0,0,0,0.5); }

        header {
            position: absolute; top: 15px; left: 15px; right: 15px;
            z-index: 10; display: flex; gap: 10px;
        }

        .btn-glass {
            background: rgba(24, 24, 27, 0.85); backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1); color: white;
            padding: 10px 18px; border-radius: 12px; cursor: pointer;
            font-size: 14px; transition: 0.2s;
        }
        .btn-glass:hover { background: rgba(39, 39, 42, 0.9); }

        .controls-panel {
            background: var(--card);
            padding: 20px;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
            z-index: 20;
        }

        .label { font-size: 10px; color: #71717a; text-transform: uppercase; margin-bottom: 8px; display: block; letter-spacing: 1px;}

        .scroll-group { 
            display: flex; gap: 10px; overflow-x: auto; 
            padding-bottom: 10px; scrollbar-width: none; 
            mask-image: linear-gradient(to right, black 85%, transparent);
        }
        .scroll-group::-webkit-scrollbar { display: none; }

        .chip {
            flex: 0 0 auto; background: #27272a; padding: 10px 16px; 
            border-radius: 12px; border: none; color: #a1a1aa; cursor: pointer;
            transition: 0.3s; font-size: 13px;
        }
        .chip.active { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(244, 63, 94, 0.4); }

        .slider-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px; }
        input[type="range"] { width: 100%; accent-color: var(--primary); cursor: pointer; }

        .btn-export {
            width: 100%; padding: 16px; border-radius: 14px; border: none;
            background: linear-gradient(135deg, var(--primary), #e11d48); 
            color: white; font-weight: bold;
            font-size: 16px; cursor: pointer; margin-top: 20px;
            transition: transform 0.1s;
        }
        .btn-export:active { transform: scale(0.98); }

        #export-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9);
            display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100;
        }
    </style>
</head>
<body>

    <header>
        <label class="btn-glass">ðŸ“‚ Load Video <input type="file" id="videoUpload" accept="video/*" style="display:none"></label>
        <button class="btn-glass" id="mirrorBtn" onclick="toggleMirror()">ðŸªž Mirror: ON</button>
        <button class="btn-glass" id="filterBtn" onclick="toggleFilter()">ðŸŽ¨ Filter: OFF</button>
    </header>

    <div class="preview-window">
        <div id="export-overlay"><h1 id="pct">0%</h1><p>Rendering High Quality WebM...</p></div>
        <canvas id="canvas"></canvas>
        <video id="videoSource" playsinline muted loop style="display:none"></video>
    </div>

    <div class="controls-panel">
        <div class="section">
            <span class="label">FX Layouts (12 Presets)</span>
            <div class="scroll-group" id="layoutList">
                <button class="chip active" onclick="setLayout('single')">Default</button>
                <button class="chip" onclick="setLayout('strip-h')">Film Strip (H)</button>
                <button class="chip" onclick="setLayout('strip-v')">Film Strip (V)</button>
                <button class="chip" onclick="setLayout('quad')">Quad Grid</button>
                <button class="chip" onclick="setLayout('9-grid')">9-Grid</button>
                <button class="chip" onclick="setLayout('triple-v')">Triple Split</button>
                <button class="chip" onclick="setLayout('mirror-lr')">Mirror L|R</button>
                <button class="chip" onclick="setLayout('diagonal')">Diagonal</button>
                <button class="chip" onclick="setLayout('center-focus')">Focus Blur</button>
                <button class="chip" onclick="setLayout('corner-pip')">Corner Inset</button>
                <button class="chip" onclick="setLayout('kaleidoscope')">Kaleidoscope</button>
                <button class="chip" onclick="setLayout('cross')">Cross Flip</button>
            </div>
        </div>

        <div class="slider-row">
            <div>
                <span class="label">Animation Speed</span>
                <input type="range" id="slideSpeed" min="0" max="100" value="20">
            </div>
            <div>
                <span class="label">Scale / Zoom</span>
                <input type="range" id="videoScale" min="10" max="200" value="100">
            </div>
        </div>

        <button class="btn-export" onclick="startExport()">Export Slideshow (WebM)</button>
    </div>

<script>
    const video = document.getElementById('videoSource');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    let currentLayout = 'single';
    let isMirror = true;
    let currentFilter = 'none';
    let offset = 0;
    let isExporting = false;

    document.getElementById('videoUpload').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            video.src = URL.createObjectURL(file);
            video.onloadedmetadata = () => {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                video.play();
                drawLoop();
            };
        }
    });

    function setLayout(l) { 
        currentLayout = l; 
        document.querySelectorAll('.chip').forEach(c => {
            c.classList.toggle('active', c.getAttribute('onclick').includes(`'${l}'`));
        });
    }

    function toggleMirror() { 
        isMirror = !isMirror; 
        document.getElementById('mirrorBtn').innerText = `ðŸªž Mirror: ${isMirror ? 'ON' : 'OFF'}`;
    }

    function toggleFilter() {
        const filters = ['none', 'grayscale(1)', 'sepia(0.8)', 'hue-rotate(90deg)', 'contrast(1.5)'];
        let idx = filters.indexOf(currentFilter);
        currentFilter = filters[(idx + 1) % filters.length];
        document.getElementById('filterBtn').innerText = `ðŸŽ¨ Filter: ${currentFilter === 'none' ? 'OFF' : 'ON'}`;
    }

    function drawLoop() {
        if (!video.src || isExporting) return;
        renderFrame();
        requestAnimationFrame(drawLoop);
    }

    function renderFrame() {
        const w = canvas.width;
        const h = canvas.height;
        const speed = document.getElementById('slideSpeed').value / 1000;
        const scale = document.getElementById('videoScale').value / 100;
        
        offset = (offset + speed) % 1;

        ctx.filter = currentFilter;
        ctx.clearRect(0, 0, w, h);

        // Utility to handle scaling within layouts
        const drawSized = (vx, vy, vw, vh) => {
            const sw = vw * scale;
            const sh = vh * scale;
            ctx.drawImage(video, vx + (vw-sw)/2, vy + (vh-sh)/2, sw, sh);
        };

        switch(currentLayout) {
            case 'single':
                drawSized(0, 0, w, h);
                break;

            case 'strip-h':
                let sh = offset * w;
                ctx.drawImage(video, sh, 0, w, h);
                ctx.drawImage(video, sh - w, 0, w, h);
                break;

            case 'strip-v':
                let sv = offset * h;
                ctx.drawImage(video, 0, sv, w, h);
                ctx.drawImage(video, 0, sv - h, w, h);
                break;

            case 'quad':
                for(let x=0; x<2; x++) 
                    for(let y=0; y<2; y++) 
                        ctx.drawImage(video, x*(w/2), y*(h/2), w/2, h/2);
                break;

            case '9-grid':
                for(let x=0; x<3; x++) 
                    for(let y=0; y<3; y++) 
                        ctx.drawImage(video, x*(w/3), y*(h/3), w/3, h/3);
                break;

            case 'triple-v':
                ctx.drawImage(video, 0, 0, w/3, h);
                ctx.drawImage(video, w/3, 0, w/3, h);
                ctx.drawImage(video, (2*w)/3, 0, w/3, h);
                break;

            case 'mirror-lr':
                ctx.drawImage(video, 0, 0, w/2, h);
                ctx.save();
                ctx.translate(w, 0); ctx.scale(-1, 1);
                ctx.drawImage(video, 0, 0, w/2, h);
                ctx.restore();
                break;

            case 'diagonal':
                ctx.save();
                ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(w, h); ctx.lineTo(0, h); ctx.closePath();
                ctx.clip(); ctx.drawImage(video, 0, 0, w, h);
                ctx.restore();
                ctx.save();
                ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(w, h); ctx.lineTo(w, 0); ctx.closePath();
                ctx.clip(); ctx.translate(w, h); ctx.rotate(Math.PI);
                ctx.drawImage(video, 0, 0, w, h);
                ctx.restore();
                break;

            case 'center-focus':
                ctx.filter = 'blur(10px) brightness(0.5)';
                ctx.drawImage(video, 0, 0, w, h);
                ctx.filter = currentFilter;
                ctx.drawImage(video, w*0.15, h*0.15, w*0.7, h*0.7);
                break;

            case 'corner-pip':
                ctx.drawImage(video, 0, 0, w, h);
                ctx.lineWidth = 10; ctx.strokeStyle = "rgba(255,255,255,0.2)";
                ctx.strokeRect(w*0.6, 30, w*0.35, h*0.35);
                ctx.drawImage(video, w*0.6, 30, w*0.35, h*0.35);
                break;

            case 'kaleidoscope':
                ctx.save();
                ctx.translate(w/2, h/2);
                for(let i=0; i<8; i++) {
                    ctx.rotate(Math.PI/4);
                    ctx.drawImage(video, -w/4, -h/4, w/2, h/2);
                }
                ctx.restore();
                break;

            case 'cross':
                ctx.save();
                ctx.drawImage(video, 0, 0, w/2, h/2); 
                ctx.translate(w, 0); ctx.scale(-1, 1); ctx.drawImage(video, 0, 0, w/2, h/2);
                ctx.translate(0, h); ctx.scale(1, -1); ctx.drawImage(video, 0, 0, w/2, h/2);
                ctx.translate(w, 0); ctx.scale(-1, 1); ctx.drawImage(video, 0, 0, w/2, h/2);
                ctx.restore();
                break;
        }

        if (isMirror && currentLayout !== 'single') {
            ctx.globalAlpha = 0.1;
            ctx.fillStyle = 'white';
            ctx.fillRect(0,0,w,h);
            ctx.globalAlpha = 1.0;
        }
    }

    async function startExport() {
        if (!video.src) return;
        isExporting = true;
        video.pause(); video.currentTime = 0; video.loop = false;

        const chunks = [];
        const stream = canvas.captureStream(30);
        const recorder = new MediaRecorder(stream, { 
            mimeType: 'video/webm; codecs=vp9', 
            videoBitsPerSecond: 8000000 
        });

        document.getElementById('export-overlay').style.display = 'flex';
        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.onstop = () => {
            const blob = new Blob(chunks, { type: 'video/webm' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `FX_Slideshow_${Date.now()}.webm`;
            a.click();
            setTimeout(() => window.location.reload(), 1000);
        };

        recorder.start();
        video.play();

        const exportLoop = () => {
            if (video.ended) { recorder.stop(); return; }
            renderFrame();
            document.getElementById('pct').innerText = Math.floor((video.currentTime/video.duration)*100) + "%";
            requestAnimationFrame(exportLoop);
        };
        exportLoop();
    }
</script>
</body>
</html>